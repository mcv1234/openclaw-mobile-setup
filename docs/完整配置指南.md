# 手机 AI 助手配置指南

## OpenClaw + GLM API + Tailscale 远程访问

配置日期：2026年2月6日

---

## 配置概览

本文档记录了在 Android 手机（vivo V2055A）上配置 OpenClaw AI 助手的完整过程，
使用 GLM-4.7 API（智谱 AI），并通过 Tailscale 实现远程访问。

### 配置表

| 配置项 | 内容 |
|--------|------|
| 设备 | vivo V2055A (Android 14) + Windows 11 电脑 |
| Linux 环境 | Andronix Ubuntu 22.04 XFCE (ARM64) in Termux |
| AI 框架 | OpenClaw 2026.2.2-3 |
| LLM API | GLM-4.7 (智谱 AI Zhipu AI) |
| 远程访问 | Tailscale P2P VPN + SSH 密钥认证 |
| 运行时 | Node.js 22.12.0 + npm 10.9.0 |

---

## 安装步骤

### nano 编辑器基础（必读）

本文档多次使用 `nano` 编辑器编辑配置文件。基本操作：

| 操作 | 快捷键 |
|------|--------|
| 保存并退出 | `Ctrl + X`，然后按 `Y`，再按 `Enter` |
| 不保存退出 | `Ctrl + X`，然后按 `N` |
| 移动光标 | 方向键 |
| 删除字符 | `Backspace` 或 `Delete` |
| 搜索文字 | `Ctrl + W`，输入文字，按 `Enter` |

**记住：修改完成后，按 `Ctrl + X` → 按 `Y` → 按 `Enter`**

### 1. 基础环境准备

已安装组件：
- Termux (Android 终端模拟器)
- Andronix Ubuntu 22.04 XFCE (通过 Andronix 安装)
- ADB (Android Debug Bridge，用于 PC 端调试)

### 2. Ubuntu 启动脚本

**Ubuntu 启动脚本位置：** `~/ubuntu22-xfce.sh`

**快捷方式（在 ~/.bashrc 中配置）：**
```bash
alias ubuntu='bash ~/ubuntu22-xfce.sh'
```

### 3. Node.js 22 安装

由于 Ubuntu 默认仓库的 Node.js 版本过旧（v12），使用官方预编译包安装：

**下载 Node.js 22 ARM64 官方预编译包：**
```bash
cd /tmp
wget https://nodejs.org/dist/v22.12.0/node-v22.12.0-linux-arm64.tar.xz
```

**解压并安装：**
```bash
tar -xf node-v22.12.0-linux-arm64.tar.xz
cd node-v22.12.0-linux-arm64
cp -R * /usr/local/
apt install -y xz-utils  # 如需解压 xz 文件
```

**创建符号链接：**
```bash
ln -sf /usr/local/bin/node /usr/bin/node
ln -sf /usr/local/bin/npm /usr/bin/npm
```

**验证安装：**
```bash
node -v   # v22.12.0
npm -v    # 10.9.0
```

### 4. OpenClaw 安装与配置

**安装 OpenClaw：**
```bash
npm install -g openclaw@latest
```

---

## 【核心】5. Bionic Bypass 修复（Android 环境必需）

**问题描述：**

Android 的 Bionic C 库与 glibc 不完全兼容，Node.js 的 `os.networkInterfaces()`
会返回 "Unknown system error 13"，导致 OpenClaw 无法启动。

**解决步骤：**

**步骤 1：创建 hijack.js 覆盖 networkInterfaces**

在 Ubuntu 中创建：
```bash
cat > ~/hijack.js << "EOF"
const os = require("os");
os.networkInterfaces = () => ({});
EOF
```

**步骤 2：设置 NODE_OPTIONS 持久化（关键！）**

NODE_OPTIONS 环境变量需要在每次启动 Ubuntu 时自动设置，
这样 Node.js 进程会自动加载 hijack.js。

**方法：修改 ubuntu22-xfce.sh，让它创建包含 NODE_OPTIONS 的 .bash_profile**

在 Termux 中执行（**不是 Ubuntu！**）：

```bash
# 1. 备份原脚本
cp ~/ubuntu22-xfce.sh ~/ubuntu22-xfce.sh.bak

# 2. 修改脚本，在创建 .bash_profile 时添加 NODE_OPTIONS
sed -i '/echo "#!\/bin\/bash/a\\nexport NODE_OPTIONS="-r \/root\/hijack.js"' ~/ubuntu22-xfce.sh

# 3. 注释掉删除 .bash_profile 的行
sed -i 's/rm -rf ~\/.bash_profile/# rm -rf ~\/.bash_profile/' ~/ubuntu22-xfce.sh

# 4. 删除旧的 .bash_profile
rm -f ~/ubuntu22-fs/root/.bash_profile

# 5. 重新启动 Ubuntu，新的 .bash_profile 会自动创建
```

验证 NODE_OPTIONS：
```bash
echo $NODE_OPTIONS  # 应该显示: -r /root/hijack.js
```

**验证配置成功：**
```bash
openclaw gateway  # 应该不再报错
```

---

### 6. OpenClaw 配置向导

**首次配置：**
1. 运行: `openclaw onboard`
2. 选择: Local gateway
3. API Provider: Z.AI (GLM 4.7)
4. Gateway bind: Lan (允许局域网访问)
5. Gateway auth: Token
6. Tailscale exposure: Off
7. **Skills 配置：**
   - ✅ **勾选 brave-search** (搜索能力)
   - ✅ 勾选 clawhub
   - 其他依赖 Homebrew 的跳过

**Brave Search 配置：**

在配置向导中勾选 `brave-search` 后，系统会提示配置 API Key：
- 输入你的 Brave Search API Key
- 或选择跳过（稍后配置）

如果跳过或需要修改：
```bash
# 在 Ubuntu 中执行
openclaw config set skills.brave-search.apiKey "你的API_Key"
```

**代理配置（必需，因为 api.search.brave.com 被墙）：**

代理配置文件已自动创建：`/root/.proxy.conf`

**【重要】代理地址必须使用手机 IP，不能用 127.0.0.1！**

在 Termux 中查看手机 IP：
```bash
ip addr show wlan0 | grep 'inet '
# 输出示例：inet 192.168.1.111/24
# 手机 IP 是 192.168.1.111
```

编辑代理配置：
```bash
# 在 Ubuntu 中执行
nano ~/.proxy.conf
```

**nano 编辑器使用说明：**
- 方向键：移动光标
- `Backspace` / `Delete`：删除字符
- 修改完成后，按 `Ctrl + X` 退出
- 按 `Y` 确认保存
- 按 `Enter` 确认文件名

取消下面两行的注释（删除开头的 #）并修改端口和 IP：
```bash
export https_proxy=http://192.168.1.111:7890
export http_proxy=http://192.168.1.111:7890
```

> ⚠️ **注意：** 必须使用手机实际 IP（如 `192.168.1.111`），不能用 `127.0.0.1`！

**常见代理软件默认端口：**
- NekoBox/Clash: 7890
- v2rayN: 10809
- Shadowsocks: 1080

**启动 OpenClaw 的正确方式：**
```bash
# 使用专用启动脚本（只对 OpenClaw 加载代理）
~/start-openclaw.sh gateway
```

**【重要】不要直接运行 `openclaw gateway`！**
- 直接运行不会加载代理，Brave Search 不可用
- 使用 `~/start-openclaw.sh gateway` 才会加载代理

**如果不配置代理：** Brave Search 功能将不可用，但其他 AI 功能正常。
- v2rayN: 10809
- Shadowsocks: 1080

保存后重新启动 Ubuntu 即可。

**如果不配置代理：** Brave Search 功能将不可用，但其他 AI 功能正常。

**【重要】保存 Token：**

配置完成后，OpenClaw 会显示一个 **Access Token**，格式类似：
```
4d267f951e2896c00a8a804586beb86160b0d36604b59f2a
```

**务必保存这个 Token！** 它是访问 OpenClaw 的密钥。

**查看 Token 方法：**
```bash
# 在 Ubuntu 中执行
openclaw config get gateway.token
```

**如果丢失 Token，重新生成：**
```bash
# 在 Ubuntu 中执行
openclaw config set gateway.token ""
# 重新运行 openclaw gateway
# 新的 token 会显示在启动日志中
```

### 7. Tailscale 配置

**手机端：**
- 从 Google Play 或官网安装 Tailscale Android App
- 打开 App，使用 GitHub/Google/Microsoft 账号登录
- 记录分配的 Tailscale IP

**电脑端：**
- 从 tailscale.com/download/windows 下载并安装
- 使用相同的账号登录

### 8. SSH 配置（密钥认证）

SSH 配置完成后，你可以在电脑上通过 SSH 访问手机，不需要用数据线连接。

**8.1 在 Termux 中安装 SSH**

```bash
pkg install openssh
passwd  # 设置密码（首次连接时会用到）
```

输入密码时屏幕不会显示，输入完成后按回车即可。

**8.2 获取 Termux 用户名和手机 IP**

**方法 1：在 Termux 中查看**
```bash
# 查看当前用户名（格式：u0_数字）
whoami
# 输出示例：u0_a328

# 查看手机 IP 地址
ip addr show wlan0 | grep 'inet '
# 输出示例：inet 192.168.1.111/24 brd 192.168.1.255 scope global wlan0
# IP 地址是 192.168.1.111
```

**方法 2：查看 Termux 首页标题**
- 打开 Termux App
- 顶部标题栏会显示用户名，格式如 `u0_a328@localhost`

**8.3 在电脑上生成 SSH 密钥对**

打开 Windows 命令提示符或 PowerShell：
```bash
ssh-keygen -t ed25519 -f C:\Users\<你的Windows用户名>\.ssh\termux_tailscale
```

按回车使用默认路径，再按两次回车（不设置密码短语）。

生成的文件：
- 私钥：`C:\Users\<用户名>\.ssh\termux_tailscale`
- 公钥：`C:\Users\<用户名>\.ssh\termux_tailscale.pub`

**8.4 复制公钥到手机**

**方法 1：通过 SSH 复制（需要手机和电脑在同一 Wi-Fi）**

```bash
# 格式：cat 公钥文件 | ssh -p 8022 用户名@手机IP "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
# 示例：
cat C:\Users\mcvh\.ssh\termux_tailscale.pub | ssh -p 8022 u0_a328@192.168.1.111 \
  "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

**首次连接会提示：**
```
The authenticity of host '[192.168.1.111]:8022' can't be established.
...
Are you sure you want to continue connecting (yes/no)?
```
输入 `yes` 并回车。

然后会提示输入密码（你在 `passwd` 命令中设置的密码）。

**方法 2：手动复制（如果 SSH 连接有问题）**

1. 在电脑上打开公钥文件：
   ```
   C:\Users\<用户名>\.ssh\termux_tailscale.pub
   ```
2. 复制全部内容（以 `ssh-ed25519` 开头的一行）
3. 在 Termux 中执行：
   ```bash
   mkdir -p ~/.ssh
   nano ~/.ssh/authorized_keys
   # 粘贴公钥内容，按 Ctrl+X 保存，按 Y 确认，按回车退出
   chmod 700 ~/.ssh
   chmod 600 ~/.ssh/authorized_keys
   ```

**8.5 简化 SSH 启动（推荐）**

在 Termux 中创建快捷命令，让以后启动 SSH 只需输入 `sshd`：

```bash
# 在 Termux 中执行（不是 Ubuntu）
echo 'sshd() { sshd -o PasswordAuthentication=no; }' >> ~/.bashrc
source ~/.bashrc
```

之后在 **Termux 新窗口** 中直接输入 `sshd` 就可以启动 SSH 服务器。

**8.6 测试 SSH 连接**

在电脑上测试：
```bash
ssh -p 8022 -i C:\Users\<用户名>\.ssh\termux_tailscale u0_a328@192.168.1.111
```

如果成功进入 Termux，说明配置成功！以后不需要输入密码。

**8.7 常见问题**

- **连接被拒绝**：手机上 Termux 的 SSH 服务未启动，在 Termux 中输入 `sshd`
- **密码错误**：确认密码正确，输入时屏幕不会显示
- **权限拒绝**：检查 `~/.ssh/authorized_keys` 权限是否为 600

---

## 使用方法

### 启动顺序

**在手机上：**
1. 打开 Termux App
2. 运行: `ubuntu`
3. 确保 Tailscale App 正在运行

**在 Termux 新窗口中启动 SSH：**
```bash
sshd  # 如果已配置快捷命令，直接输入 sshd 即可
```

**在 Ubuntu 中启动 OpenClaw：**
```bash
openclaw gateway
```

**在电脑上访问（推荐方法 - 使用启动脚本）：**

双击运行桌面上的 **start-openclaw.bat** 脚本，它会自动：
1. 配置 SSH 隧道
2. 打开浏览器访问 OpenClaw

注意：代理配置需要在手机端的 Ubuntu 中完成（见上方 Brave Search 配置）。

**手动访问方式：**

通过 SSH 隧道访问 Web UI：
```bash
ssh -N -L 18789:127.0.0.1:18789 -p 8022 -i C:\Users\<用户名>\.ssh\termux_tailscale u0_<用户ID>@<手机IP>
```

然后浏览器打开：
```
http://127.0.0.1:18789/?token=<你的token>
```

---

## 故障排除

### 问题 1：openclaw 命令找不到

**症状：** `bash: openclaw: command not found`

**原因：** npm 更新后全局包被清除，但 openclaw 仍在 node_modules 中

**解决：**
```bash
ln -sf /usr/local/lib/node_modules/openclaw/openclaw.mjs /usr/bin/openclaw
```

### 问题 2：Bionic Bypass 未生效（启动失败）

**症状：** `SystemError [ERR_SYSTEM_ERROR]: uv_interface_addresses returned Unknown system error 13`

**检查：**
```bash
echo $NODE_OPTIONS  # 应该显示: -r /root/hijack.js
```

如果为空或不对，按上面步骤 5 重新配置。

### 问题 3：npm 更新导致 openclaw 失效

**预防：**
```bash
npm install -g npm@10.9.0
```
OpenClaw 提示更新时选择 Skip（跳过）

### 问题 4：SSH 连接被拒绝

```bash
pkill sshd && sshd -o PasswordAuthentication=no
```

### 问题 5：Brave Search 搜索失败

**症状：** AI 回答说无法搜索网络，或提示 fetch failed

**原因：**
1. 未配置 API Key
2. 未配置代理或代理配置错误
3. 代理软件未运行

**解决步骤：**
```bash
# 1. 检查 API Key 是否配置
openclaw config get skills.brave-search.apiKey

# 2. 如未配置，设置 API Key
openclaw config set skills.brave-search.apiKey "你的API_Key"

# 3. 检查代理配置
cat ~/.proxy.conf
# 应该看到取消注释的 export https_proxy 和 export http_proxy

# 4. 如果代理配置不对，编辑配置文件
nano ~/.proxy.conf
# 取消注释并修改端口，保存后重启 Ubuntu

# 5. 确保代理软件在手机上运行
```

### 问题 6：SSH 连接被拒绝

```bash
pkill sshd && sshd -o PasswordAuthentication=no
```

### 问题 7：开启代理后 SSH 连不上

**症状：** 开启"魔法"（代理软件）后，SSH 连接超时或被拒绝

**原因：** 代理地址使用了 `127.0.0.1`，在 proot 环境中无法访问 Android 层的代理软件

**解决方法：**

1. **检查代理配置：**
```bash
cat ~/.proxy.conf
```

2. **确认使用手机 IP 而不是 127.0.0.1：**
```bash
# 正确示例（使用手机 IP）
export https_proxy=http://192.168.1.111:7890
export http_proxy=http://192.168.1.111:7890

# 错误示例（会导致 SSH 问题）
export https_proxy=http://127.0.0.1:7890
export http_proxy=http://127.0.0.1:7890
```

3. **查看当前手机 IP：**
```bash
# 在 Termux 中执行
ip addr show wlan0 | grep 'inet '
```

4. **修改代理配置后，使用专用脚本启动 OpenClaw：**
```bash
~/start-openclaw.sh gateway
```

### 问题 7：GLM API 超时

**日志显示：** `Profile zai:default timed out`

**解决：**
- 检查智谱 AI 账户余额
- 在手机上开启代理（如果需要访问 API）

### 问题 8：忘记或丢失 Token

**症状：** 无法登录 OpenClaw，提示 token 无效

**解决步骤：**
```bash
# 1. 查看当前 token
openclaw config get gateway.token

# 2. 如果显示为空或想要重新生成
openclaw config set gateway.token ""

# 3. 重新启动 gateway，新 token 会显示在日志中
openclaw gateway

# 4. 从日志中复制新 token 并保存
```

---

## 关键配置信息

| 配置项 | 值 |
|--------|-----|
| Ubuntu 启动脚本 | ~/ubuntu22-xfce.sh |
| Ubuntu 文件系统 | ~/ubuntu22-fs/ |
| SSH 端口 | 8022 (Termux) |
| OpenClaw 端口 | 18789 |
| Bionic Bypass 脚本 | /root/hijack.js |
| NODE_OPTIONS | -r /root/hijack.js |
| **OpenClaw Token** | **配置时显示，用 `openclaw config get gateway.token` 查看** |
| Brave Search API | 需从 https://brave.com/search/api/ 获取 |
| 代理端口 | 根据你的代理软件设置（如 7890） |

---

## 总结

本配置实现了一个在 Android 手机上运行的 AI 助手系统，具有以下特点：

- **随时可用：** 通过 Tailscale，手机在任何网络（4G/5G/WiFi）都能被访问
- **安全可靠：** SSH 密钥认证，密码登录已禁用
- **成本低廉：** 使用 GLM API，相比 OpenAI 更经济
- **轻量便携：** 所有组件运行在 Android 手机上，无需额外服务器
- **稳定运行：** Bionic Bypass 确保 OpenClaw 在 Android 环境稳定运行
- **联网搜索：** Brave Search 集成，AI 可获取最新网络信息（需配置代理）

---

**文档版本：** v4.0 (新增 Brave Search 完整配置方案)
**最后更新：** 2026年2月6日
